import React, { useEffect, useRef, useState } from "react";
import * as echarts from "echarts";
import { use } from "echarts/core";

const xAxis = { data: [] };

const MonthlyRainfallAnalysis = () => {
  const [inputValue, setInputValue] = useState("BTC/USD");
  const chartRef = useRef(null);
  const [loading, setLoading] = useState(true);
  const [date, setDate] = useState(null);
  const [day, setDay] = useState(7);
  const [chartInstance, setChartInstance] = useState(null);
  const [option, setOption] = useState(null);

  const initData = () => {
    setLoading(true);
    fetch("/api2/predict", {
      method: "GET",
      // headers: {
      //   "Content-Type": "application/json",
      // },
      // body: JSON.stringify({}),
    })
      .then((res) => {
        if (!res.ok) {
          throw new Error(`HTTP error! Status: ${res.status}`);
        }
        return res.json();
      })
      .then((data) => {
        init(data);
      })
      .catch((error) => {
        console.error("Fetch error: ", error);
      });
  };

  const init = (data)=>{
    const chartInstance = echarts.init(chartRef.current);

    // Define the chart options, will update the data dynamically later
    const option = {
      tooltip: {
        trigger: "axis",
      },
      legend: {
        data: ["Predicted Prices", "Actual Prices"],
        right: "0",
        textStyle: {
          fontSize: 10,
        },
        bottom: "5%",
      },
      grid: {
        left: "3%",
        right: "4%",
        bottom: "12%",
        containLabel: true,
      },
      xAxis: {
        type: "category",
        boundaryGap: false,
        data: data.dates.splice(0,30), // Initially empty, will be filled by the API response
      },
      yAxis: {
        type: "value",
      },
      series: [
        {
          name: "true claims & predicted_claims",
          type: "bar",
          data: data.precipitation.splice(0,30), // Initially empty, will be filled by the API response
        },
      ],
    };
    setChartInstance(chartInstance);
    chartInstance.setOption(option);
    setLoading(false);
  }

  useEffect(() => {
    // initData();
    init({
      "dates": [
          "2023-05-27",
          "2023-05-28",
          "2023-05-29",
          "2023-05-30",
          "2023-05-31",
          "2023-06-01",
          "2023-06-02",
          "2023-06-03",
          "2023-06-04",
          "2023-06-05",
          "2023-06-06",
          "2023-06-07",
          "2023-06-08",
          "2023-06-09",
          "2023-06-10",
          "2023-06-11",
          "2023-06-12",
          "2023-06-13",
          "2023-06-14",
          "2023-06-15",
          "2023-06-16",
          "2023-06-17",
          "2023-06-18",
          "2023-06-19",
          "2023-06-20",
          "2023-06-21",
          "2023-06-22",
          "2023-06-23",
          "2023-06-24",
          "2023-06-25",
          "2023-06-26",
          "2023-06-27",
          "2023-06-28",
          "2023-06-29",
          "2023-06-30",
          "2023-07-01",
          "2023-07-02",
          "2023-07-03",
          "2023-07-04",
          "2023-07-05",
          "2023-07-06",
          "2023-07-07",
          "2023-07-08",
          "2023-07-09",
          "2023-07-10",
          "2023-07-11",
          "2023-07-12",
          "2023-07-13",
          "2023-07-14",
          "2023-07-15",
          "2023-07-16",
          "2023-07-17",
          "2023-07-18",
          "2023-07-19",
          "2023-07-20",
          "2023-07-21",
          "2023-07-22",
          "2023-07-23",
          "2023-07-24",
          "2023-07-25",
          "2023-07-26",
          "2023-07-27",
          "2023-07-28",
          "2023-07-29",
          "2023-07-30",
          "2023-07-31",
          "2023-08-01",
          "2023-08-02",
          "2023-08-03",
          "2023-08-04",
          "2023-08-05",
          "2023-08-06",
          "2023-08-07",
          "2023-08-08",
          "2023-08-09",
          "2023-08-10",
          "2023-08-11",
          "2023-08-12",
          "2023-08-13",
          "2023-08-14",
          "2023-08-15",
          "2023-08-16",
          "2023-08-17",
          "2023-08-18",
          "2023-08-19",
          "2023-08-20",
          "2023-08-21",
          "2023-08-22",
          "2023-08-23",
          "2023-08-24",
          "2023-08-25",
          "2023-08-26",
          "2023-08-27",
          "2023-08-28",
          "2023-08-29",
          "2023-08-30",
          "2023-08-31",
          "2023-09-01",
          "2023-09-02",
          "2023-09-03",
          "2023-09-04",
          "2023-09-05",
          "2023-09-06",
          "2023-09-07",
          "2023-09-08",
          "2023-09-09",
          "2023-09-10",
          "2023-09-11",
          "2023-09-12",
          "2023-09-13",
          "2023-09-14",
          "2023-09-15",
          "2023-09-16",
          "2023-09-17",
          "2023-09-18",
          "2023-09-19",
          "2023-09-20",
          "2023-09-21",
          "2023-09-22",
          "2023-09-23",
          "2023-09-24",
          "2023-09-25",
          "2023-09-26",
          "2023-09-27",
          "2023-09-28",
          "2023-09-29",
          "2023-09-30",
          "2023-10-01",
          "2023-10-02",
          "2023-10-03",
          "2023-10-04",
          "2023-10-05",
          "2023-10-06",
          "2023-10-07",
          "2023-10-08",
          "2023-10-09",
          "2023-10-10",
          "2023-10-11",
          "2023-10-12",
          "2023-10-13",
          "2023-10-14",
          "2023-10-15",
          "2023-10-16",
          "2023-10-17",
          "2023-10-18",
          "2023-10-19",
          "2023-10-20",
          "2023-10-21",
          "2023-10-22",
          "2023-10-23",
          "2023-10-24",
          "2023-10-25",
          "2023-10-26",
          "2023-10-27",
          "2023-10-28",
          "2023-10-29",
          "2023-10-30",
          "2023-10-31",
          "2023-11-01",
          "2023-11-02",
          "2023-11-03",
          "2023-11-04",
          "2023-11-05",
          "2023-11-06",
          "2023-11-07",
          "2023-11-08",
          "2023-11-09",
          "2023-11-10",
          "2023-11-11",
          "2023-11-12",
          "2023-11-13",
          "2023-11-14",
          "2023-11-15",
          "2023-11-16",
          "2023-11-17",
          "2023-11-18",
          "2023-11-19",
          "2023-11-20",
          "2023-11-21",
          "2023-11-22",
          "2023-11-23",
          "2023-11-24",
          "2023-11-25",
          "2023-11-26",
          "2023-11-27",
          "2023-11-28",
          "2023-11-29",
          "2023-11-30",
          "2023-12-01",
          "2023-12-02",
          "2023-12-03",
          "2023-12-04",
          "2023-12-05",
          "2023-12-06",
          "2023-12-07",
          "2023-12-08",
          "2023-12-09",
          "2023-12-10",
          "2023-12-11",
          "2023-12-12",
          "2023-12-13",
          "2023-12-14",
          "2023-12-15",
          "2023-12-16",
          "2023-12-17",
          "2023-12-18",
          "2023-12-19",
          "2023-12-20",
          "2023-12-21",
          "2023-12-22",
          "2023-12-23",
          "2023-12-24",
          "2023-12-25",
          "2023-12-26",
          "2023-12-27",
          "2023-12-28",
          "2023-12-29",
          "2023-12-30",
          "2023-12-31",
          "2024-01-01",
          "2024-01-02",
          "2024-01-03",
          "2024-01-04",
          "2024-01-05",
          "2024-01-06",
          "2024-01-07",
          "2024-01-08",
          "2024-01-09",
          "2024-01-10",
          "2024-01-11",
          "2024-01-12",
          "2024-01-13",
          "2024-01-14",
          "2024-01-15",
          "2024-01-16",
          "2024-01-17",
          "2024-01-18",
          "2024-01-19",
          "2024-01-20",
          "2024-01-21",
          "2024-01-22",
          "2024-01-23",
          "2024-01-24",
          "2024-01-25",
          "2024-01-26",
          "2024-01-27",
          "2024-01-28",
          "2024-01-29",
          "2024-01-30",
          "2024-01-31",
          "2024-02-01",
          "2024-02-02",
          "2024-02-03",
          "2024-02-04",
          "2024-02-05",
          "2024-02-06",
          "2024-02-07",
          "2024-02-08",
          "2024-02-09",
          "2024-02-10",
          "2024-02-11",
          "2024-02-12",
          "2024-02-13",
          "2024-02-14",
          "2024-02-15",
          "2024-02-16",
          "2024-02-17",
          "2024-02-18",
          "2024-02-19",
          "2024-02-20",
          "2024-02-21",
          "2024-02-22",
          "2024-02-23",
          "2024-02-24",
          "2024-02-25",
          "2024-02-26",
          "2024-02-27",
          "2024-02-28",
          "2024-02-29",
          "2024-03-01",
          "2024-03-02",
          "2024-03-03",
          "2024-03-04",
          "2024-03-05",
          "2024-03-06",
          "2024-03-07",
          "2024-03-08",
          "2024-03-09",
          "2024-03-10",
          "2024-03-11",
          "2024-03-12",
          "2024-03-13",
          "2024-03-14",
          "2024-03-15",
          "2024-03-16",
          "2024-03-17",
          "2024-03-18",
          "2024-03-19",
          "2024-03-20",
          "2024-03-21",
          "2024-03-22",
          "2024-03-23",
          "2024-03-24",
          "2024-03-25",
          "2024-03-26"
      ],
      "true_claims": [
          13670,
          12422,
          17764,
          17177,
          16256,
          16703,
          16966,
          14412,
          13565,
          19461,
          17515,
          17053,
          16538,
          17686,
          14907,
          13386,
          18822,
          18509,
          17751,
          17239,
          16914,
          14316,
          13149,
          18387,
          17104,
          18809,
          14631,
          14550,
          14972,
          19146,
          18566,
          18003,
          16614,
          16690,
          16666,
          13694,
          12753,
          19294,
          17713,
          17173,
          17013,
          17044,
          14654,
          13953,
          18140,
          16926,
          16676,
          16574,
          17257,
          15246,
          14298,
          18943,
          17815,
          18281,
          18081,
          17207,
          14644,
          13509,
          18264,
          17530,
          16781,
          16292,
          17229,
          14843,
          14028,
          18674,
          19001,
          17960,
          17111,
          17852,
          14490,
          13817,
          18813,
          18225,
          18016,
          17862,
          18064,
          15255,
          14456,
          19623,
          18966,
          19092,
          17764,
          17937,
          15226,
          13708,
          19792,
          18666,
          19304,
          18644,
          18889,
          16653,
          15150,
          20888,
          19182,
          18282,
          18252,
          18312,
          15051,
          14236,
          19320,
          18115,
          17660,
          17192,
          17840,
          15202,
          13601,
          18627,
          18245,
          17780,
          17405,
          17852,
          15585,
          14315,
          19779,
          18345,
          18426,
          18056,
          18589,
          16042,
          18095,
          18981,
          19147,
          21598,
          16616,
          14508,
          14874,
          15776,
          16799,
          16163,
          16059,
          15909,
          21555,
          20577,
          15857,
          20646,
          19415,
          18519,
          18306,
          18966,
          15803,
          14377,
          19599,
          18322,
          17875,
          17938,
          18484,
          15768,
          13941,
          19454,
          18423,
          18364,
          17617,
          18293,
          15559,
          14599,
          19510,
          18398,
          17709,
          17315,
          18073,
          15068,
          14503,
          19687,
          18404,
          18057,
          17604,
          17597,
          12742,
          11793,
          18678,
          17959,
          17765,
          17749,
          17602,
          15593,
          14254,
          19911,
          18684,
          18829,
          17704,
          18432,
          15439,
          14195,
          19558,
          18573,
          18526,
          18446,
          18364,
          15736,
          14291,
          19683,
          18444,
          17346,
          17849,
          18196,
          15242,
          14899,
          20578,
          19309,
          18553,
          18190,
          18337,
          15476,
          14715,
          20144,
          18883,
          18360,
          17835,
          18619,
          14694,
          13742,
          19797,
          21610,
          21673,
          23251,
          16136,
          15449,
          15088,
          20427,
          19575,
          19258,
          20600,
          21015,
          16920,
          14582,
          20160,
          19314,
          18733,
          18373,
          18349,
          15512,
          13928,
          19930,
          18340,
          17495,
          17244,
          17405,
          13717,
          12433,
          18107,
          17483,
          17085,
          16326,
          17051,
          14369,
          12902,
          17324,
          16988,
          15741,
          15274,
          15829,
          13139,
          14084,
          14354,
          13537,
          11303,
          6572,
          5705,
          8155,
          8879,
          9174,
          9964,
          12289,
          18311,
          19641,
          18223,
          14987,
          17816,
          16292,
          16229,
          16164,
          15076,
          15058,
          14713,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null,
          null
      ],
      "predicted_claims": [
          16037,
          15777,
          15345,
          15585,
          15834,
          15976,
          16145,
          16321,
          16151,
          15835,
          16252,
          16485,
          16636,
          16683,
          16841,
          16633,
          16203,
          16459,
          16742,
          16931,
          17022,
          17038,
          16698,
          16193,
          16369,
          16463,
          16787,
          16581,
          16319,
          16107,
          16450,
          16773,
          17011,
          17027,
          17006,
          16961,
          16533,
          15981,
          16286,
          16489,
          16630,
          16728,
          16805,
          16559,
          16201,
          16382,
          16467,
          16524,
          16557,
          16667,
          16517,
          16227,
          16526,
          16731,
          16983,
          17183,
          17233,
          16919,
          16435,
          16567,
          16676,
          16708,
          16670,
          16742,
          16514,
          16171,
          16426,
          16784,
          17010,
          17087,
          17215,
          16889,
          16450,
          16659,
          16861,
          17045,
          17189,
          17331,
          17088,
          16712,
          17003,
          17266,
          17540,
          17612,
          17662,
          17338,
          16803,
          17065,
          17259,
          17541,
          17719,
          17892,
          17740,
          17363,
          17726,
          17910,
          17962,
          17980,
          17989,
          17566,
          17036,
          17195,
          17274,
          17313,
          17288,
          17340,
          17053,
          16555,
          16715,
          16899,
          17039,
          17116,
          17227,
          17033,
          16655,
          16978,
          17174,
          17370,
          17490,
          17647,
          17451,
          17491,
          17653,
          17841,
          18330,
          18144,
          17631,
          17154,
          16838,
          16723,
          16591,
          16482,
          16381,
          17021,
          17575,
          17472,
          17895,
          18135,
          18209,
          18208,
          18266,
          17901,
          17345,
          17492,
          17545,
          17560,
          17581,
          17671,
          17408,
          16900,
          17115,
          17264,
          17416,
          17456,
          17561,
          17301,
          16901,
          17144,
          17299,
          17368,
          17366,
          17445,
          17132,
          16733,
          17017,
          17201,
          17337,
          17392,
          17421,
          16813,
          16069,
          16238,
          16436,
          16645,
          16842,
          16994,
          16859,
          16520,
          16893,
          17161,
          17429,
          17515,
          17650,
          17372,
          16909,
          17143,
          17313,
          17482,
          17622,
          17727,
          17467,
          17000,
          17237,
          17376,
          17377,
          17427,
          17513,
          17213,
          16855,
          17245,
          17530,
          17702,
          17787,
          17856,
          17533,
          17095,
          17377,
          17558,
          17670,
          17692,
          17794,
          17378,
          16826,
          17077,
          17644,
          18233,
          18973,
          18692,
          18222,
          17684,
          17882,
          18040,
          18170,
          18463,
          18789,
          18540,
          17944,
          18083,
          18167,
          18192,
          18166,
          18133,
          17732,
          17132,
          17345,
          17433,
          17429,
          17386,
          17361,
          16866,
          16207,
          16308,
          16431,
          16539,
          16548,
          16633,
          16373,
          15912,
          16013,
          16144,
          16137,
          16059,
          16043,
          15698,
          15462,
          15293,
          15065,
          14590,
          13566,
          12455,
          11708,
          11212,
          10902,
          10799,
          11047,
          12075,
          13387,
          14492,
          15024,
          15667,
          16004,
          16204,
          16309,
          16221,
          16092,
          15911,
          15889,
          15892,
          15909,
          15933,
          15963,
          15994,
          16026,
          16059,
          16092,
          16123,
          16154,
          16185,
          16216,
          16246,
          16274,
          16301,
          16327,
          16352,
          16374,
          16394,
          16412,
          16430,
          16447,
          16463,
          16479,
          16493,
          16507,
          16521,
          16534
      ],
      "precipitation": [
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          500,
          1750,
          500,
          0,
          0,
          0,
          0,
          500,
          1750,
          500,
          0,
          1750,
          0,
          0,
          0,
          500,
          0,
          1750,
          7500,
          1750,
          500,
          1750,
          1750,
          3750,
          500,
          500,
          500,
          500,
          500,
          0,
          500,
          17500,
          500,
          500,
          0,
          500,
          500,
          0,
          0,
          0,
          0,
          7500,
          500,
          500,
          500,
          0,
          0,
          0,
          0,
          7500,
          0,
          500,
          0,
          0,
          1750,
          0,
          0,
          500,
          500,
          500,
          1750,
          1750,
          7500,
          1750,
          500,
          0,
          3750,
          1750,
          1750,
          500,
          500,
          17500,
          3750,
          1750,
          0,
          3750,
          0,
          0,
          0,
          1750,
          1750,
          500,
          3750,
          500,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          500,
          0,
          500,
          0,
          500,
          0,
          1750,
          7500,
          500,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          500,
          0,
          0,
          0,
          500,
          500,
          3750,
          7500,
          3750,
          500,
          0,
          500,
          500,
          500,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          500,
          500,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          500,
          500,
          0,
          0,
          0,
          500,
          500,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          500,
          3750,
          0,
          0,
          0,
          0,
          0,
          500,
          500,
          1750,
          500,
          500,
          500,
          500,
          500,
          500,
          500,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          500,
          0,
          0,
          500,
          0,
          0,
          500,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          500,
          500,
          0,
          0,
          0,
          500,
          0,
          0,
          500,
          0,
          0,
          0,
          500,
          0,
          0,
          0,
          0,
          0,
          500,
          0,
          0,
          0,
          0,
          500,
          500,
          0,
          500,
          500,
          500,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          500,
          500,
          500,
          500,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0
      ]
  });
  }, []);

  console.log("option", chartInstance?.getOption());
  return (
    <div style={styles.outerContainer}>
      {/* White Content Container */}
      {/* ECharts Graph */}
      {loading ? (
        <div style={styles.graphLoading}>Graph Data is Loading...</div>
      ) : (
        <></>
      )}
      <div
        ref={chartRef}
        style={{
          ...styles.graph,
          ...{ visibility: loading ? "hidden" : "visible" },
        }}
      ></div>
    </div>
  );
};

// Styles
const styles = {
  outerContainer: {
    padding: "0px",
    height: "100%",
    width:"100%",
    boxSizing: "border-box",
  },

  container: {
    padding: "20px",
    fontFamily: "Inter, sans-serif",
    color: "#333",
    marginTop: "30px",
    marginLeft: "50px",
    marginRight: "50px",
    backgroundColor: "#FFF",
    borderRadius: "8px",
    height: "510px",
    minHeight: "500px",
    overflow: "hidden",
  },
  header: {
    display: "flex",
    flexDirection: "column",
    gap: "20px",
  },
  title: {
    fontSize: "28px",
    fontWeight: "600",
  },
  searchAndActions: {
    display: "flex",
    alignItems: "center",
    justifyContent: "space-between",
    gap: "15px",
  },
  dropdownWrapper: {
    display: "flex",
    alignItems: "center",
    border: "1px solid #C4B5FD",
    borderRadius: "8px",
    backgroundColor: "#FFF",
    padding: "6px 10px",
    width: "300px",
    height: "26px",
    justifyContent: "center",
  },
  buttonGroup: {
    display: "flex",
    gap: "15px",
    alignItems: "center",
  },
  mainContent: {
    display: "flex",
    gap: "20px",
    marginTop: "30px",
  },
  stockInfo: {
    flex: 1,
    backgroundColor: "#FFF",
    borderRadius: "10px",
    padding: "20px",
  },
  bitcoinIcon: {
    width: "50px",
    height: "50px",
    objectFit: "contain",
  },
  stockTitle: {
    fontSize: "28px",
    fontWeight: "bold",
    marginBottom: "10px",
  },
  stockDescription: {
    fontSize: "16px",
    color: "#757575",
    lineHeight: "1.6",
    fontWeight: "400px",
  },
  graphSection: {
    flex: 2,
    backgroundColor: "#FFF",
    borderRadius: "10px",
    padding: "0px",
  },
  graphHeader: {
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center",
    marginBottom: "2px",
  },
  downloadButton: {
    backgroundColor: "rgba(177, 144, 244, 0.80)",
    display: "flex",
    gap: "8px",
    alignItems: "center",
    padding: "8px 16px",
    border: "none",
    borderRadius: "5px",
    cursor: "pointer",
    height: "39px",
  },
  downloadIcon: {
    display: "flex",
    alignItems: "center",
  },
  downloadText: {
    color: "#202A3A",
    fontFamily: "Inter, sans-serif",
    fontSize: "16px",
    fontWeight: "400",
    lineHeight: "normal",
  },
  refreshButton: {
    backgroundColor: "#FFFFFF",
    border: "1px solid #CCC",
    padding: "8px 10px",
    borderRadius: "5px",
    cursor: "pointer",
  },
  graphTitle: {
    fontSize: "24px",
    fontWeight: "bold",
    color: "#676767",
    fontFamily: "Inter, sans-serif",
  },
  graph: {
    height: "100%",
    borderRadius: "10px",
    display: "flex",
    justifyContent: "center",
    alignItems: "center",
    color: "#AAA",
    height: "100%",
    width: "100%",
  },
  graphLoading: {
    width: "100%",
    height: "100%",
    display: "flex",
    alignItems: "center",
    color: "#888",
    // justifyContent:"center",
    paddingLeft: "30px",
  },
  dropdown: {
    border: "none",
    outline: "none",
    fontSize: "14px",
    color: "#9299A5",
    flex: 1,
    backgroundColor: "transparent",
    cursor: "pointer",
  },
};

export default MonthlyRainfallAnalysis;
